name: Codex README Title Check

on:
  schedule:
    - cron: "0 3 * * *"     # Runs every day at 03:00 UTC
  workflow_dispatch: {}      # Allows manual trigger from GitHub UI

jobs:
  codex-readme-title:
    runs-on: ubuntu-latest

    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Read README.md into variable
        id: readme
        run: |
          if [ ! -f README.md ]; then
            echo "README.md not found"
            echo "content=" >> $GITHUB_OUTPUT
          else
            # Save README content into a workflow output variable
            CONTENT=$(sed 's/"/\\"/g' README.md)
            echo "content=\"$CONTENT\"" >> $GITHUB_OUTPUT
          fi

      - name: Run Codex Exec on README
        uses: openai/codex-action@v1
        with:
          openai-api-key: ${{ secrets.OPENAI_API_KEY }}
          prompt: |
            You are Codex running inside GitHub Actions.

            Here is the README.md content from this repository:

            ---
            ${{ steps.readme.outputs.content }}
            ---

            Tasks:
            1. Find the main H1 title (the line starting with "# ").
            2. Extract the exact text of that title.
            3. Determine if ALL letters in the title are capitalized (ignore spaces/punctuation).
            4. Output ONLY:

            Title: <title>
            All Caps: <YES or NO>
